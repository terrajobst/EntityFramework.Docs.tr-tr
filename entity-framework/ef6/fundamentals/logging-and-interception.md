---
title: Günlüğe kaydetme ve veritabanı işlemleri - EF6 kesintiye
author: divega
ms.date: 10/23/2016
ms.assetid: b5ee7eb1-88cc-456e-b53c-c67e24c3f8ca
ms.openlocfilehash: 3f06e073f3ab6e46883663620219e302d5db1d60
ms.sourcegitcommit: 2b787009fd5be5627f1189ee396e708cd130e07b
ms.translationtype: MT
ms.contentlocale: tr-TR
ms.lasthandoff: 09/13/2018
ms.locfileid: "45490097"
---
# <a name="logging-and-intercepting-database-operations"></a><span data-ttu-id="bb0e6-102">Günlüğe kaydetme ve veritabanı işlemleri kesintiye</span><span class="sxs-lookup"><span data-stu-id="bb0e6-102">Logging and intercepting database operations</span></span>
> [!NOTE]
> <span data-ttu-id="bb0e6-103">**EF6 ve sonraki sürümler yalnızca** -özellikler, API'ler, bu sayfada açıklanan vb., Entity Framework 6'da sunulmuştur.</span><span class="sxs-lookup"><span data-stu-id="bb0e6-103">**EF6 Onwards Only** - The features, APIs, etc. discussed in this page were introduced in Entity Framework 6.</span></span> <span data-ttu-id="bb0e6-104">Önceki bir sürümü kullanıyorsanız, bazı veya tüm bilgileri geçerli değildir.</span><span class="sxs-lookup"><span data-stu-id="bb0e6-104">If you are using an earlier version, some or all of the information does not apply.</span></span>  

<span data-ttu-id="bb0e6-105">Entity Framework veritabanı için bir komutu, bu komut gönderir. herhangi bir zamanda Entity Framework 6 ile başlayarak, uygulama kodu tarafından yakalanabilir.</span><span class="sxs-lookup"><span data-stu-id="bb0e6-105">Starting with Entity Framework 6, anytime Entity Framework sends a command to the database this command can be intercepted by application code.</span></span> <span data-ttu-id="bb0e6-106">SQL günlüğü için en yaygın olarak kullanılır, ancak değiştirmek veya komutu durdurun için de kullanılabilir.</span><span class="sxs-lookup"><span data-stu-id="bb0e6-106">This is most commonly used for logging SQL, but can also be used to modify or abort the command.</span></span>  

<span data-ttu-id="bb0e6-107">Özellikle, EF içerir:</span><span class="sxs-lookup"><span data-stu-id="bb0e6-107">Specifically, EF includes:</span></span>  

- <span data-ttu-id="bb0e6-108">LINQ to SQL'de DataContext.Log benzer bağlamı için bir günlük özelliği</span><span class="sxs-lookup"><span data-stu-id="bb0e6-108">A Log property for the context similar to DataContext.Log in LINQ to SQL</span></span>  
- <span data-ttu-id="bb0e6-109">İçerik ve'ına gönderilen çıktı biçimlendirme özelleştirmek için bir mekanizma</span><span class="sxs-lookup"><span data-stu-id="bb0e6-109">A mechanism to customize the content and formatting of the output sent to the log</span></span>  
- <span data-ttu-id="bb0e6-110">Daha fazla denetim/esnekliğini durdurma için alt düzey yapı taşları</span><span class="sxs-lookup"><span data-stu-id="bb0e6-110">Low-level building blocks for interception giving greater control/flexibility</span></span>  

## <a name="context-log-property"></a><span data-ttu-id="bb0e6-111">İçerik günlüğü özelliği</span><span class="sxs-lookup"><span data-stu-id="bb0e6-111">Context Log property</span></span>  

<span data-ttu-id="bb0e6-112">DbContext.Database.Log özelliği bir dize alır herhangi bir yöntem için temsilci olarak ayarlanabilir.</span><span class="sxs-lookup"><span data-stu-id="bb0e6-112">The DbContext.Database.Log property can be set to a delegate for any method that takes a string.</span></span> <span data-ttu-id="bb0e6-113">En yaygın olarak ayarlayarak bu TextWriter "Yazma" yöntemi için herhangi bir TextWriter ile kullanılır.</span><span class="sxs-lookup"><span data-stu-id="bb0e6-113">Most commonly it is used with any TextWriter by setting it to the “Write” method of that TextWriter.</span></span> <span data-ttu-id="bb0e6-114">Geçerli bağlam tarafından oluşturulan tüm SQL yazıcının için günlüğe kaydedilir.</span><span class="sxs-lookup"><span data-stu-id="bb0e6-114">All SQL generated by the current context will be logged to that writer.</span></span> <span data-ttu-id="bb0e6-115">Örneğin, aşağıdaki kod, konsola SQL başlar.SSH:</span><span class="sxs-lookup"><span data-stu-id="bb0e6-115">For example, the following code will log SQL to the console:</span></span>  

``` csharp
using (var context = new BlogContext())
{
    context.Database.Log = Console.Write;

    // Your code here...
}
```  

<span data-ttu-id="bb0e6-116">Bu bağlamı dikkat edin. Database.Log Console.Write için ayarlanır.</span><span class="sxs-lookup"><span data-stu-id="bb0e6-116">Notice that context.Database.Log is set to Console.Write.</span></span> <span data-ttu-id="bb0e6-117">Tüm SQL konsolunda oturum için gereken budur.</span><span class="sxs-lookup"><span data-stu-id="bb0e6-117">This is all that is needed to log SQL to the console.</span></span>  

<span data-ttu-id="bb0e6-118">Biz bazı çıkış görebilmeniz için bazı basit sorgu/ekleme/güncelleştirme kod ekleyelim:</span><span class="sxs-lookup"><span data-stu-id="bb0e6-118">Let’s add some simple query/insert/update code so that we can see some output:</span></span>  

``` csharp
using (var context = new BlogContext())
{
    context.Database.Log = Console.Write;

    var blog = context.Blogs.First(b => b.Title == "One Unicorn");

    blog.Posts.First().Title = "Green Eggs and Ham";

    blog.Posts.Add(new Post { Title = "I do not like them!" });

    context.SaveChangesAsync().Wait();
}
```  

<span data-ttu-id="bb0e6-119">Bu, aşağıdaki çıktıyı üretir:</span><span class="sxs-lookup"><span data-stu-id="bb0e6-119">This will generate the following output:</span></span>  

``` SQL
SELECT TOP (1)
    [Extent1].[Id] AS [Id],
    [Extent1].[Title] AS [Title]
    FROM [dbo].[Blogs] AS [Extent1]
    WHERE (N'One Unicorn' = [Extent1].[Title]) AND ([Extent1].[Title] IS NOT NULL)
-- Executing at 10/8/2013 10:55:41 AM -07:00
-- Completed in 4 ms with result: SqlDataReader

SELECT
    [Extent1].[Id] AS [Id],
    [Extent1].[Title] AS [Title],
    [Extent1].[BlogId] AS [BlogId]
    FROM [dbo].[Posts] AS [Extent1]
    WHERE [Extent1].[BlogId] = @EntityKeyValue1
-- EntityKeyValue1: '1' (Type = Int32)
-- Executing at 10/8/2013 10:55:41 AM -07:00
-- Completed in 2 ms with result: SqlDataReader

UPDATE [dbo].[Posts]
SET [Title] = @0
WHERE ([Id] = @1)
-- @0: 'Green Eggs and Ham' (Type = String, Size = -1)
-- @1: '1' (Type = Int32)
-- Executing asynchronously at 10/8/2013 10:55:41 AM -07:00
-- Completed in 12 ms with result: 1

INSERT [dbo].[Posts]([Title], [BlogId])
VALUES (@0, @1)
SELECT [Id]
FROM [dbo].[Posts]
WHERE @@ROWCOUNT > 0 AND [Id] = scope_identity()
-- @0: 'I do not like them!' (Type = String, Size = -1)
-- @1: '1' (Type = Int32)
-- Executing asynchronously at 10/8/2013 10:55:41 AM -07:00
-- Completed in 2 ms with result: SqlDataReader
```  

<span data-ttu-id="bb0e6-120">(Bu veritabanı sıfırlamaları çoktan olmuş varsayarsak çıkış olduğunu unutmayın.</span><span class="sxs-lookup"><span data-stu-id="bb0e6-120">(Note that this is the output assuming any database initialization has already happened.</span></span> <span data-ttu-id="bb0e6-121">"Olacaktır sonra veritabanı başlatma zaten olmayan oluştuysa tüm iş geçişler gösteren çok daha fazla çıkış olup olmadığını denetleyin veya yeni bir veritabanı oluşturmak için arka planda gerçekleştirir.)</span><span class="sxs-lookup"><span data-stu-id="bb0e6-121">If database initialization had not already happened then there would be a lot more output showing all the work Migrations does under the covers to check for or create a new database.)</span></span>  

## <a name="what-gets-logged"></a><span data-ttu-id="bb0e6-122">Oturum?</span><span class="sxs-lookup"><span data-stu-id="bb0e6-122">What gets logged?</span></span>  

<span data-ttu-id="bb0e6-123">Günlük özelliği aşağıdakilerin tümü ayarlandığında kaydedilir:</span><span class="sxs-lookup"><span data-stu-id="bb0e6-123">When the Log property is set all of the following will be logged:</span></span>  

- <span data-ttu-id="bb0e6-124">SQL komutları tüm farklı türleri için.</span><span class="sxs-lookup"><span data-stu-id="bb0e6-124">SQL for all different kinds of commands.</span></span> <span data-ttu-id="bb0e6-125">Örneğin:</span><span class="sxs-lookup"><span data-stu-id="bb0e6-125">For example:</span></span>  
    - <span data-ttu-id="bb0e6-126">Normal LINQ sorguları, eSQL sorgular ve ham sorgularından SqlQuery gibi yöntemleri dahil olmak üzere sorgular</span><span class="sxs-lookup"><span data-stu-id="bb0e6-126">Queries, including normal LINQ queries, eSQL queries, and raw queries from methods such as SqlQuery</span></span>  
    - <span data-ttu-id="bb0e6-127">Ekleme, güncelleştirme ve silme SaveChanges bir parçası olarak oluşturulan</span><span class="sxs-lookup"><span data-stu-id="bb0e6-127">Inserts, updates, and deletes generated as part of SaveChanges</span></span>  
    - <span data-ttu-id="bb0e6-128">İlişki sorgular tarafından Gecikmeli yükleme oluşturulanların gibi yükleniyor</span><span class="sxs-lookup"><span data-stu-id="bb0e6-128">Relationship loading queries such as those generated by lazy loading</span></span>  
- <span data-ttu-id="bb0e6-129">Parametreler</span><span class="sxs-lookup"><span data-stu-id="bb0e6-129">Parameters</span></span>  
- <span data-ttu-id="bb0e6-130">Bir komut olup olmadığını zaman uyumsuz olarak yürütülüyor</span><span class="sxs-lookup"><span data-stu-id="bb0e6-130">Whether or not the command is being executed asynchronously</span></span>  
- <span data-ttu-id="bb0e6-131">Komut yürütme başlatıldığında belirten bir zaman damgası</span><span class="sxs-lookup"><span data-stu-id="bb0e6-131">A timestamp indicating when the command started executing</span></span>  
- <span data-ttu-id="bb0e6-132">Komut başarıyla tamamlandı, özel bir durum yaratarak veya, zaman uyumsuz başarısız olsun veya olmasın, iptal edildi</span><span class="sxs-lookup"><span data-stu-id="bb0e6-132">Whether or not the command completed successfully, failed by throwing an exception, or, for async, was canceled</span></span>  
- <span data-ttu-id="bb0e6-133">Sonuç değeri bazı göstergesi</span><span class="sxs-lookup"><span data-stu-id="bb0e6-133">Some indication of the result value</span></span>  
- <span data-ttu-id="bb0e6-134">Bu komutu yürütmek için geçen süre yaklaşık miktarı.</span><span class="sxs-lookup"><span data-stu-id="bb0e6-134">The approximate amount of time it took to execute the command.</span></span> <span data-ttu-id="bb0e6-135">Bu sonuç nesnesi geri almak için komut göndermesini saat olduğuna dikkat edin.</span><span class="sxs-lookup"><span data-stu-id="bb0e6-135">Note that this is the time from sending the command to getting the result object back.</span></span> <span data-ttu-id="bb0e6-136">Sonuçları okuma süresi içermez.</span><span class="sxs-lookup"><span data-stu-id="bb0e6-136">It does not include time to read the results.</span></span>  

<span data-ttu-id="bb0e6-137">Yukarıdaki örnek çıktısına baktığınızda, her oturum dört komuttan biri şunlardır:</span><span class="sxs-lookup"><span data-stu-id="bb0e6-137">Looking at the example output above, each of the four commands logged are:</span></span>  

- <span data-ttu-id="bb0e6-138">Bağlam çağrısından kaynaklanan sorgu. Blogs.First</span><span class="sxs-lookup"><span data-stu-id="bb0e6-138">The query resulting from the call to context.Blogs.First</span></span>  
    - <span data-ttu-id="bb0e6-139">ToString çağrılabilir Iqueryable SQL alma ToString yöntemini beri bu sorgu için öğrenmeniz gerekir bildirimi "First" sağlamaz</span><span class="sxs-lookup"><span data-stu-id="bb0e6-139">Notice that the ToString method of getting the SQL would not have worked for this query since “First” does not provide an IQueryable on which ToString could be called</span></span>  
- <span data-ttu-id="bb0e6-140">Yavaş-yüklenmesini blog sonuçlanan sorgu. Gönderiler</span><span class="sxs-lookup"><span data-stu-id="bb0e6-140">The query resulting from the lazy-loading of blog.Posts</span></span>  
    - <span data-ttu-id="bb0e6-141">Bildirimi anahtar değeri geç hangi yükleme için parametre ayrıntılarını olmuyor.</span><span class="sxs-lookup"><span data-stu-id="bb0e6-141">Notice the parameter details for the key value for which lazy loading is happening</span></span>  
    - <span data-ttu-id="bb0e6-142">Varsayılan olmayan değerlere ayarlanır özellikleri parametresinin günlüğe kaydedilir.</span><span class="sxs-lookup"><span data-stu-id="bb0e6-142">Only properties of the parameter that are set to non-default values are logged.</span></span> <span data-ttu-id="bb0e6-143">Örneğin, boyut özelliği yalnızca sıfır olup olmadığını gösterilir.</span><span class="sxs-lookup"><span data-stu-id="bb0e6-143">For example, the Size property is only shown if it is non-zero.</span></span>  
- <span data-ttu-id="bb0e6-144">İki komuttan SaveChangesAsync kaynaklanan; bir güncelleştirme sonrası başlık, yeni bir gönderi eklemek bir ekleme için diğer değiştirmek için</span><span class="sxs-lookup"><span data-stu-id="bb0e6-144">Two commands resulting from SaveChangesAsync; one for the update to change a post title, the other for an insert to add a new post</span></span>  
    - <span data-ttu-id="bb0e6-145">FK ve başlık özelliklerini parametre ayrıntılarını dikkat edin.</span><span class="sxs-lookup"><span data-stu-id="bb0e6-145">Notice the parameter details for the FK and Title properties</span></span>  
    - <span data-ttu-id="bb0e6-146">Bu komutları yürütülürken zaman uyumsuz olarak dikkat edin.</span><span class="sxs-lookup"><span data-stu-id="bb0e6-146">Notice that these commands are being executed asynchronously</span></span>  

## <a name="logging-to-different-places"></a><span data-ttu-id="bb0e6-147">Farklı konumlara günlüğe kaydetme</span><span class="sxs-lookup"><span data-stu-id="bb0e6-147">Logging to different places</span></span>  

<span data-ttu-id="bb0e6-148">Günlüğe kaydetme için yukarıda da gösterildiği gibi konsolun çok kolaydır.</span><span class="sxs-lookup"><span data-stu-id="bb0e6-148">As shown above logging to the console is super easy.</span></span> <span data-ttu-id="bb0e6-149">Bellek, dosya, vb. için farklı kullanarak oturum kolaydır, [TextWriter](https://msdn.microsoft.com/library/system.io.textwriter.aspx).</span><span class="sxs-lookup"><span data-stu-id="bb0e6-149">It’s also easy to log to memory, file, etc. by using different kinds of [TextWriter](https://msdn.microsoft.com/library/system.io.textwriter.aspx).</span></span>  

<span data-ttu-id="bb0e6-150">LINQ ile SQL, LINQ to SQL günlüğü özelliği gerçek TextWriter nesnesinde (örneğin, Console.Out) sırasında bir dize (örneğin kabul eden bir yönteme günlük özelliği ayarlanmış EF ayarlı görebilirsiniz biliyorsanız Console.Write veya Console.Out.Write).</span><span class="sxs-lookup"><span data-stu-id="bb0e6-150">If you are familiar with LINQ to SQL you might notice that in LINQ to SQL the Log property is set to the actual TextWriter object (for example, Console.Out) while in EF the Log property is set to a method that accepts a string (for example, Console.Write or Console.Out.Write).</span></span> <span data-ttu-id="bb0e6-151">Bunun nedeni TextWriter'dan EF dizeleri için bir havuz olarak davranıp herhangi bir temsilci kabul ederek ayırmaktır.</span><span class="sxs-lookup"><span data-stu-id="bb0e6-151">The reason for this is to decouple EF from TextWriter by accepting any delegate that can act as a sink for strings.</span></span> <span data-ttu-id="bb0e6-152">Örneğin, bazı günlüğe kaydetme çerçevesi zaten var ve bir günlük yöntemi tanımlar Imagine şu şekilde:</span><span class="sxs-lookup"><span data-stu-id="bb0e6-152">For example, imagine that you already have some logging framework and it defines a logging method like so:</span></span>  

``` csharp
public class MyLogger
{
    public void Log(string component, string message)
    {
        Console.WriteLine("Component: {0} Message: {1} ", component, message);
    }
}
```  

<span data-ttu-id="bb0e6-153">Bu gibi bu EF günlük özelliğine ölçekledikçe:</span><span class="sxs-lookup"><span data-stu-id="bb0e6-153">This could be hooked up to the EF Log property like this:</span></span>  

``` csharp
var logger = new MyLogger();
context.Database.Log = s => logger.Log("EFApp", s);
```  

## <a name="result-logging"></a><span data-ttu-id="bb0e6-154">Sonucu günlüğe kaydetme</span><span class="sxs-lookup"><span data-stu-id="bb0e6-154">Result logging</span></span>  

<span data-ttu-id="bb0e6-155">Komut veritabanına gönderilmeden önce varsayılan Günlükçü komut metni (SQL), parametreler ve "Executing" satırın zaman damgası ile kaydeder.</span><span class="sxs-lookup"><span data-stu-id="bb0e6-155">The default logger logs command text (SQL), parameters, and the “Executing” line with a timestamp before the command is sent to the database.</span></span> <span data-ttu-id="bb0e6-156">Geçen süreyi içeren bir "tamamlandı" oturum aşağıdaki komutun yürütülmesi satırıdır.</span><span class="sxs-lookup"><span data-stu-id="bb0e6-156">A “completed” line containing elapsed time is logged following execution of the command.</span></span>  

<span data-ttu-id="bb0e6-157">Zaman uyumsuz görev gerçekten tamamlandıktan, başarısız veya iptal kadar zaman uyumsuz komutları için "tamamlandı" satırı kaydedilmez unutmayın.</span><span class="sxs-lookup"><span data-stu-id="bb0e6-157">Note that for async commands the “completed” line is not logged until the async task actually completes, fails, or is canceled.</span></span>  

<span data-ttu-id="bb0e6-158">"Tamamlandı" satırı komut ve yürütme başarılı olsun veya olmasın türüne bağlı olarak farklı bilgiler içerir.</span><span class="sxs-lookup"><span data-stu-id="bb0e6-158">The “completed” line contains different information depending on the type of command and whether or not execution was successful.</span></span>  

### <a name="successful-execution"></a><span data-ttu-id="bb0e6-159">Başarılı yürütme</span><span class="sxs-lookup"><span data-stu-id="bb0e6-159">Successful execution</span></span>  

<span data-ttu-id="bb0e6-160">Çıkış başarıyla tamamlanması komutlar için "x sonucuyla ms içinde tamamlandı:" sonucu neydi bazı göstergesini tarafından izlenen.</span><span class="sxs-lookup"><span data-stu-id="bb0e6-160">For commands that complete successfully the output is “Completed in x ms with result: “ followed by some indication of what the result was.</span></span> <span data-ttu-id="bb0e6-161">Bir veri okuyucu sonuç komutlarında türünü göstergesidir [dbdatareader öğesine dönüştürülemedi](https://msdn.microsoft.com/library/system.data.common.dbdatareader.aspx) döndürdü.</span><span class="sxs-lookup"><span data-stu-id="bb0e6-161">For commands that return a data reader the result indication is the type of [DbDataReader](https://msdn.microsoft.com/library/system.data.common.dbdatareader.aspx) returned.</span></span> <span data-ttu-id="bb0e6-162">Güncelleştirme gibi bir tamsayı değeri döndüren komutlar için gösterilen sonuç gösterilen komutu bu tamsayıdır.</span><span class="sxs-lookup"><span data-stu-id="bb0e6-162">For commands that return an integer value such as the update command shown above the result shown is that integer.</span></span>  

### <a name="failed-execution"></a><span data-ttu-id="bb0e6-163">Başarısız yürütme</span><span class="sxs-lookup"><span data-stu-id="bb0e6-163">Failed execution</span></span>  

<span data-ttu-id="bb0e6-164">Bir özel durum ile başarısız komutları için çıkış özel durumdan ileti içerir.</span><span class="sxs-lookup"><span data-stu-id="bb0e6-164">For commands that fail by throwing an exception, the output contains the message from the exception.</span></span> <span data-ttu-id="bb0e6-165">Örneğin, SqlQuery için var olan bir tablo sorgusu kullanarak günlük sonucunda aşağıdakine benzer çıktıyı verir:</span><span class="sxs-lookup"><span data-stu-id="bb0e6-165">For example, using SqlQuery to query against a table that does exist will result in log output something like this:</span></span>  

``` SQL
SELECT * from ThisTableIsMissing
-- Executing at 5/13/2013 10:19:05 AM
-- Failed in 1 ms with error: Invalid object name 'ThisTableIsMissing'.
```  

### <a name="canceled-execution"></a><span data-ttu-id="bb0e6-166">Yürütme işlemi iptal edildi</span><span class="sxs-lookup"><span data-stu-id="bb0e6-166">Canceled execution</span></span>  

<span data-ttu-id="bb0e6-167">Bu iptal etme denemesi yapıldığında, temel alınan ADO.NET sağlayıcısı genellikle yaptığı olduğundan burada görev iptal zaman uyumsuz komutları için sonuç bir özel durum ile başarısız olabilir.</span><span class="sxs-lookup"><span data-stu-id="bb0e6-167">For async commands where the task is canceled the result could be failure with an exception, since this is what the underlying ADO.NET provider often does when an attempt is made to cancel.</span></span> <span data-ttu-id="bb0e6-168">Bu gerçekleşmez ve görev düzgün bir şekilde iptal çıktısı aşağıdakine benzer görünecektir:</span><span class="sxs-lookup"><span data-stu-id="bb0e6-168">If this doesn’t happen and the task is canceled cleanly then the output will look something like this:</span></span>  

```  
update Blogs set Title = 'No' where Id = -1
-- Executing asynchronously at 5/13/2013 10:21:10 AM
-- Canceled in 1 ms
```  

## <a name="changing-log-content-and-formatting"></a><span data-ttu-id="bb0e6-169">Günlük içeriği değiştirme ve biçimlendirme</span><span class="sxs-lookup"><span data-stu-id="bb0e6-169">Changing log content and formatting</span></span>  

<span data-ttu-id="bb0e6-170">Özelliğin sağlar Database.Log perde DatabaseLogFormatter nesnesinin kullanın.</span><span class="sxs-lookup"><span data-stu-id="bb0e6-170">Under the covers the Database.Log property makes use of a DatabaseLogFormatter object.</span></span> <span data-ttu-id="bb0e6-171">Bu nesne (aşağıya bakın) IDbCommandInterceptor uygulama dizeleri ve bir DbContext kabul eden bir temsilci etkili bir şekilde bağlar.</span><span class="sxs-lookup"><span data-stu-id="bb0e6-171">This object effectively binds an IDbCommandInterceptor implementation (see below) to a delegate that accepts strings and a DbContext.</span></span> <span data-ttu-id="bb0e6-172">Bu, DatabaseLogFormatter yöntemlerde önce ve sonra komutların yürütülmesini EF tarafından çağrılır, anlamına gelir.</span><span class="sxs-lookup"><span data-stu-id="bb0e6-172">This means that methods on DatabaseLogFormatter are called before and after the execution of commands by EF.</span></span> <span data-ttu-id="bb0e6-173">Bu DatabaseLogFormatter yöntemleri toplayın ve günlük çıktısı biçimlendirmek ve temsilciye gönderebilirsiniz.</span><span class="sxs-lookup"><span data-stu-id="bb0e6-173">These DatabaseLogFormatter methods gather and format log output and send it to the delegate.</span></span>  

### <a name="customizing-databaselogformatter"></a><span data-ttu-id="bb0e6-174">DatabaseLogFormatter özelleştirme</span><span class="sxs-lookup"><span data-stu-id="bb0e6-174">Customizing DatabaseLogFormatter</span></span>  

<span data-ttu-id="bb0e6-175">Günlüğe kaydedilenler ve nasıl biçimlendirildiğini değiştirme, DatabaseLogFormatter türetir ve uygun yöntemleri geçersiz kılan bir yeni sınıf oluşturarak gerçekleştirilebilir.</span><span class="sxs-lookup"><span data-stu-id="bb0e6-175">Changing what is logged and how it is formatted can be achieved by creating a new class that derives from DatabaseLogFormatter and overrides methods as appropriate.</span></span> <span data-ttu-id="bb0e6-176">Geçersiz kılmak için en yaygın yöntemler şunlardır:</span><span class="sxs-lookup"><span data-stu-id="bb0e6-176">The most common methods to override are:</span></span>  

- <span data-ttu-id="bb0e6-177">LogCommand – bu komutları nasıl bunlar yürütülmeden önce günlüğe kaydedildiğini değiştirmek için geçersiz.</span><span class="sxs-lookup"><span data-stu-id="bb0e6-177">LogCommand – Override this to change how commands are logged before they are executed.</span></span> <span data-ttu-id="bb0e6-178">Varsayılan olarak, her parametre için LogParameter LogCommand çağırır; geçersiz kılma aynı yapın veya bunun yerine parametreleri farklı şekilde işlemek tercih edebilirsiniz.</span><span class="sxs-lookup"><span data-stu-id="bb0e6-178">By default LogCommand calls LogParameter for each parameter; you may choose to do the same in your override or handle parameters differently instead.</span></span>  
- <span data-ttu-id="bb0e6-179">LogResult – bir komutun yürütülmesini sonucu nasıl kaydedilir değiştirmek için geçersiz kılar.</span><span class="sxs-lookup"><span data-stu-id="bb0e6-179">LogResult – Override this to change how the outcome from executing a command is logged.</span></span>  
- <span data-ttu-id="bb0e6-180">LogParameter – bu biçimlendirme ve parametre günlük içeriğini değiştirmek için geçersiz.</span><span class="sxs-lookup"><span data-stu-id="bb0e6-180">LogParameter – Override this to change the formatting and content of parameter logging.</span></span>  

<span data-ttu-id="bb0e6-181">Örneğin, her komut veritabanına gönderilmeden önce tek bir satır oturum istedik varsayalım.</span><span class="sxs-lookup"><span data-stu-id="bb0e6-181">For example, suppose we wanted to log just a single line before each command is sent to the database.</span></span> <span data-ttu-id="bb0e6-182">Bu iki geçersiz kılma ile yapılabilir:</span><span class="sxs-lookup"><span data-stu-id="bb0e6-182">This can be done with two overrides:</span></span>  

- <span data-ttu-id="bb0e6-183">Biçimlendirme ve tek satırlık bir SQL yazma LogCommand geçersiz kıl</span><span class="sxs-lookup"><span data-stu-id="bb0e6-183">Override LogCommand to format and write the single line of SQL</span></span>  
- <span data-ttu-id="bb0e6-184">Hiçbir şey yapmıyor LogResult geçersiz kılar.</span><span class="sxs-lookup"><span data-stu-id="bb0e6-184">Override LogResult to do nothing.</span></span>  

<span data-ttu-id="bb0e6-185">Kod aşağıdaki gibi görünür:</span><span class="sxs-lookup"><span data-stu-id="bb0e6-185">The code would look something like this:</span></span>

``` csharp
public class OneLineFormatter : DatabaseLogFormatter
{
    public OneLineFormatter(DbContext context, Action<string> writeAction)
        : base(context, writeAction)
    {
    }

    public override void LogCommand<TResult>(
        DbCommand command, DbCommandInterceptionContext<TResult> interceptionContext)
    {
        Write(string.Format(
            "Context '{0}' is executing command '{1}'{2}",
            Context.GetType().Name,
            command.CommandText.Replace(Environment.NewLine, ""),
            Environment.NewLine));
    }

    public override void LogResult<TResult>(
        DbCommand command, DbCommandInterceptionContext<TResult> interceptionContext)
    {
    }
}
```  

<span data-ttu-id="bb0e6-186">Oturum çıktı yapılandırılmış yazma temsilciye gönderir yazma yönteminin yalnızca çağrı çıktı.</span><span class="sxs-lookup"><span data-stu-id="bb0e6-186">To log output simply call the Write method which will send output to the configured write delegate.</span></span>  

<span data-ttu-id="bb0e6-187">(Bu kodu satır sonları alıyormuş kaldırılmasını yalnızca örnek olarak yaptığı unutmayın.</span><span class="sxs-lookup"><span data-stu-id="bb0e6-187">(Note that this code does simplistic removal of line breaks just as an example.</span></span> <span data-ttu-id="bb0e6-188">Bu büyük olasılıkla iyi karmaşık SQL görüntülemek için çalışmaz.)</span><span class="sxs-lookup"><span data-stu-id="bb0e6-188">It will likely not work well for viewing complex SQL.)</span></span>  

### <a name="setting-the-databaselogformatter"></a><span data-ttu-id="bb0e6-189">DatabaseLogFormatter ayarlama</span><span class="sxs-lookup"><span data-stu-id="bb0e6-189">Setting the DatabaseLogFormatter</span></span>  

<span data-ttu-id="bb0e6-190">Yeni bir DatabaseLogFormatter sınıf oluşturulduktan sonra EF ile kayıtlı olması gerekir.</span><span class="sxs-lookup"><span data-stu-id="bb0e6-190">Once a new DatabaseLogFormatter class has been created it needs to be registered with EF.</span></span> <span data-ttu-id="bb0e6-191">Bu yapılır kod tabanlı yapılandırma kullanarak.</span><span class="sxs-lookup"><span data-stu-id="bb0e6-191">This is done using code-based configuration.</span></span> <span data-ttu-id="bb0e6-192">Buna koysalar bu aynı bütünleştirilmiş kodun DbContext sınıfınıza olarak DbConfiguration türeyen yeni bir sınıf oluşturursunuz ve ardından bu yeni sınıfın oluşturucusunda SetDatabaseLogFormatter arama anlamına gelir.</span><span class="sxs-lookup"><span data-stu-id="bb0e6-192">In a nutshell this means creating a new class that derives from DbConfiguration in the same assembly as your DbContext class and then calling SetDatabaseLogFormatter in the constructor of this new class.</span></span> <span data-ttu-id="bb0e6-193">Örneğin:</span><span class="sxs-lookup"><span data-stu-id="bb0e6-193">For example:</span></span>  

``` csharp
public class MyDbConfiguration : DbConfiguration
{
    public MyDbConfiguration()
    {
        SetDatabaseLogFormatter(
            (context, writeAction) => new OneLineFormatter(context, writeAction));
    }
}
```  

### <a name="using-the-new-databaselogformatter"></a><span data-ttu-id="bb0e6-194">Yeni DatabaseLogFormatter kullanma</span><span class="sxs-lookup"><span data-stu-id="bb0e6-194">Using the new DatabaseLogFormatter</span></span>  

<span data-ttu-id="bb0e6-195">Bu yeni DatabaseLogFormatter artık Database.Log ayarlanmış herhangi bir zamanda kullanılır.</span><span class="sxs-lookup"><span data-stu-id="bb0e6-195">This new DatabaseLogFormatter will now be used anytime Database.Log is set.</span></span> <span data-ttu-id="bb0e6-196">Bu nedenle, bölüm 1 ' kodu çalıştıran artık aşağıdaki çıktıda sonuçlanır:</span><span class="sxs-lookup"><span data-stu-id="bb0e6-196">So, running the code from part 1 will now result in the following output:</span></span>  

```  
Context 'BlogContext' is executing command 'SELECT TOP (1) [Extent1].[Id] AS [Id], [Extent1].[Title] AS [Title]FROM [dbo].[Blogs] AS [Extent1]WHERE (N'One Unicorn' = [Extent1].[Title]) AND ([Extent1].[Title] IS NOT NULL)'
Context 'BlogContext' is executing command 'SELECT [Extent1].[Id] AS [Id], [Extent1].[Title] AS [Title], [Extent1].[BlogId] AS [BlogId]FROM [dbo].[Posts] AS [Extent1]WHERE [Extent1].[BlogId] = @EntityKeyValue1'
Context 'BlogContext' is executing command 'update [dbo].[Posts]set [Title] = @0where ([Id] = @1)'
Context 'BlogContext' is executing command 'insert [dbo].[Posts]([Title], [BlogId])values (@0, @1)select [Id]from [dbo].[Posts]where @@rowcount > 0 and [Id] = scope_identity()'
```  

## <a name="interception-building-blocks"></a><span data-ttu-id="bb0e6-197">Durdurma yapı taşları</span><span class="sxs-lookup"><span data-stu-id="bb0e6-197">Interception building blocks</span></span>  

<span data-ttu-id="bb0e6-198">Şu ana kadar EF tarafından oluşturulan SQL oturum DbContext.Database.Log kullanmayı inceledik.</span><span class="sxs-lookup"><span data-stu-id="bb0e6-198">So far we have looked at how to use DbContext.Database.Log to log the SQL generated by EF.</span></span> <span data-ttu-id="bb0e6-199">Ancak bu kodu görece basit bir cephe gerçekten daha genel durdurma için bazı alt düzey yapı taşları üzerinden.</span><span class="sxs-lookup"><span data-stu-id="bb0e6-199">But this code is actually a relatively thin façade over some low-level building blocks for more general interception.</span></span>  

### <a name="interception-interfaces"></a><span data-ttu-id="bb0e6-200">Durdurma arabirimleri</span><span class="sxs-lookup"><span data-stu-id="bb0e6-200">Interception interfaces</span></span>  

<span data-ttu-id="bb0e6-201">Durdurma kodu durdurma arabirimleri kavramı üretilmiştir.</span><span class="sxs-lookup"><span data-stu-id="bb0e6-201">The interception code is built around the concept of interception interfaces.</span></span> <span data-ttu-id="bb0e6-202">Bu arabirimler IDbInterceptor devralır ve EF bazı eylem gerçekleştirdiğinde çağrılan yöntemlere tanımlayın.</span><span class="sxs-lookup"><span data-stu-id="bb0e6-202">These interfaces inherit from IDbInterceptor and define methods that are called when EF performs some action.</span></span> <span data-ttu-id="bb0e6-203">Amaç, bir arabirim başına geçirilmesinin nesne türü olmasını sağlamaktır.</span><span class="sxs-lookup"><span data-stu-id="bb0e6-203">The intent is to have one interface per type of object being intercepted.</span></span> <span data-ttu-id="bb0e6-204">Örneğin, önce EF ExecuteNonQuery, ExecuteScalar, ExecuteReader ve ilişkili yöntemleri çağrıda çağrılan yöntemlere IDbCommandInterceptor arabirimi tanımlar.</span><span class="sxs-lookup"><span data-stu-id="bb0e6-204">For example, the IDbCommandInterceptor interface defines methods that are called before EF makes a call to ExecuteNonQuery, ExecuteScalar, ExecuteReader, and related methods.</span></span> <span data-ttu-id="bb0e6-205">Benzer şekilde, bu işlemlerin her biri tamamlandığında çağrılan yöntemlere arabirimi tanımlar.</span><span class="sxs-lookup"><span data-stu-id="bb0e6-205">Likewise, the interface defines methods that are called when each of these operations completes.</span></span> <span data-ttu-id="bb0e6-206">Yukarıda inceledik DatabaseLogFormatter sınıfı komutları için bu arabirimi uygular.</span><span class="sxs-lookup"><span data-stu-id="bb0e6-206">The DatabaseLogFormatter class that we looked at above implements this interface to log commands.</span></span>  

### <a name="the-interception-context"></a><span data-ttu-id="bb0e6-207">Durdurma bağlamı</span><span class="sxs-lookup"><span data-stu-id="bb0e6-207">The interception context</span></span>  

<span data-ttu-id="bb0e6-208">Herhangi bir dinleyiciyi arabirimleri üzerinde tanımlanan yöntemler, bakarak her çağrı DbInterceptionContext türünde bir nesne veya bazı tür bu gibi DbCommandInterceptionContext türetildiğine emin görünen\<\>.</span><span class="sxs-lookup"><span data-stu-id="bb0e6-208">Looking at the methods defined on any of the interceptor interfaces it is apparent that every call is given an object of type DbInterceptionContext or some type derived from this such as DbCommandInterceptionContext\<\>.</span></span> <span data-ttu-id="bb0e6-209">Bu nesne EF sürüyor eylem hakkında bağlamsal bilgiler içerir.</span><span class="sxs-lookup"><span data-stu-id="bb0e6-209">This object contains contextual information about the action that EF is taking.</span></span> <span data-ttu-id="bb0e6-210">Örneğin, bir DbContext adına yapılan eylemi, DbContext DbInterceptionContext dahildir.</span><span class="sxs-lookup"><span data-stu-id="bb0e6-210">For example, if the action is being taken on behalf of a DbContext, then the DbContext is included in the DbInterceptionContext.</span></span> <span data-ttu-id="bb0e6-211">Benzer şekilde, zaman uyumsuz olarak yürütülen komutlar için üzerinde DbCommandInterceptionContext Isasync bayrağı ayarlanır.</span><span class="sxs-lookup"><span data-stu-id="bb0e6-211">Similarly, for commands that are being executed asynchronously, the IsAsync flag is set on DbCommandInterceptionContext.</span></span>  

### <a name="result-handling"></a><span data-ttu-id="bb0e6-212">Sonuç işleme</span><span class="sxs-lookup"><span data-stu-id="bb0e6-212">Result handling</span></span>  

<span data-ttu-id="bb0e6-213">DbCommandInterceptionContext\< \> sınıfı sonucu, OriginalResult, özel durum ve özgün özel durum olarak adlandırılan bir özelliklerini içerir.</span><span class="sxs-lookup"><span data-stu-id="bb0e6-213">The DbCommandInterceptionContext\<\> class contains a properties called Result, OriginalResult, Exception, and OriginalException.</span></span> <span data-ttu-id="bb0e6-214">Bu özellikler için null/sıfır işlemi yürütülmeden önce çağrılan durdurma yöntemlere yapılan çağrılar için ayarlanan — diğer bir deyişle, için... Yürütme yöntemleri.</span><span class="sxs-lookup"><span data-stu-id="bb0e6-214">These properties are set to null/zero for calls to the interception methods that are called before the operation is executed — that is, for the …Executing methods.</span></span> <span data-ttu-id="bb0e6-215">İşlemi yürütülür ve başarılı, işlemin sonucunu için sonuç ve OriginalResult ayarlanır.</span><span class="sxs-lookup"><span data-stu-id="bb0e6-215">If the operation is executed and succeeds, then Result and OriginalResult are set to the result of the operation.</span></span> <span data-ttu-id="bb0e6-216">Bu değerleri işlemi yürütüldükten sonra çağrılan durdurma yöntemlere sonra gözlenecek — diğer bir deyişle,... Yürütülen yöntemler.</span><span class="sxs-lookup"><span data-stu-id="bb0e6-216">These values can then be observed in the interception methods that are called after the operation has executed — that is, on the …Executed methods.</span></span> <span data-ttu-id="bb0e6-217">İşlemi oluşturursa, benzer şekilde, daha sonra özel durum ve özgün özel durum özellikleri ayarlanır.</span><span class="sxs-lookup"><span data-stu-id="bb0e6-217">Likewise, if the operation throws, then the Exception and OriginalException properties will be set.</span></span>  

#### <a name="suppressing-execution"></a><span data-ttu-id="bb0e6-218">Yürütme gizleme</span><span class="sxs-lookup"><span data-stu-id="bb0e6-218">Suppressing execution</span></span>  

<span data-ttu-id="bb0e6-219">Komutu yürüttüğünü önce bir dinleyiciyi sonucu özelliği ayarlar varsa (birinde... Yürütme yöntemleri) sonra EF gerçekten komutu yürütmek çalışmaz, ancak bunun yerine yalnızca sonuç kümesini kullanacak.</span><span class="sxs-lookup"><span data-stu-id="bb0e6-219">If an interceptor sets the Result property before the command has executed (in one of the …Executing methods) then EF will not attempt to actually execute the command, but will instead just use the result set.</span></span> <span data-ttu-id="bb0e6-220">Diğer bir deyişle, dinleyiciyi de komutu yürütmeye bastır ancak komutu yürüttüğünü gibi devam EF sahip.</span><span class="sxs-lookup"><span data-stu-id="bb0e6-220">In other words, the interceptor can suppress execution of the command but have EF continue as if the command had been executed.</span></span>  

<span data-ttu-id="bb0e6-221">Bu nasıl kullanılabileceğine ilişkin bir örnek, bir sarmalama sağlayıcısıyla, toplu işleme komut geleneksel olarak Tamamlandı ' dir.</span><span class="sxs-lookup"><span data-stu-id="bb0e6-221">An example of how this might be used is the command batching that has traditionally been done with a wrapping provider.</span></span> <span data-ttu-id="bb0e6-222">Dinleyiciyi komut daha sonra yürütmek için bir toplu iş olarak saklayacağından, ancak "komutu normal olarak yürütülen EF görünen".</span><span class="sxs-lookup"><span data-stu-id="bb0e6-222">The interceptor would store the command for later execution as a batch but would “pretend” to EF that the command had executed as normal.</span></span> <span data-ttu-id="bb0e6-223">Toplu işleme uygulamak için bu birden fazla gerektiriyor, ancak durdurma sonucu değiştirme nasıl kullanılabileceğine ilişkin bir örnek budur unutmayın.</span><span class="sxs-lookup"><span data-stu-id="bb0e6-223">Note that it requires more than this to implement batching, but this is an example of how changing the interception result might be used.</span></span>  

<span data-ttu-id="bb0e6-224">Yürütme ayrıca gizlenebilir birinde özel durum özelliğini ayarlayarak... Yürütme yöntemleri.</span><span class="sxs-lookup"><span data-stu-id="bb0e6-224">Execution can also be suppressed by setting the Exception property in one of the …Executing methods.</span></span> <span data-ttu-id="bb0e6-225">Bu, EF yürütme işlemi, belirtilen özel durum tarafından doğrulayamadı gibi devam etmesine neden olur.</span><span class="sxs-lookup"><span data-stu-id="bb0e6-225">This causes EF to continue as if execution of the operation had failed by throwing the given exception.</span></span> <span data-ttu-id="bb0e6-226">Bu, uygulamanın çökmesine neden neden olabilir ancak geçici bir özel durum veya EF tarafından işlenen bazı bir durum olabilir.</span><span class="sxs-lookup"><span data-stu-id="bb0e6-226">This may, of course, cause the application to crash, but it may also be a transient exception or some other exception that is handled by EF.</span></span> <span data-ttu-id="bb0e6-227">Örneğin, bu test ortamlarında komut yürütme başarısız olduğunda uygulamanın davranışını test etmek için kullanılabilir.</span><span class="sxs-lookup"><span data-stu-id="bb0e6-227">For example, this could be used in test environments to test the behavior of an application when command execution fails.</span></span>  

#### <a name="changing-the-result-after-execution"></a><span data-ttu-id="bb0e6-228">Yürütmeden sonra sonucu değiştirme</span><span class="sxs-lookup"><span data-stu-id="bb0e6-228">Changing the result after execution</span></span>  

<span data-ttu-id="bb0e6-229">Komut yürütüldükten sonra bir dinleyiciyi sonucu özelliği ayarlar varsa (birinde... Yöntemleri yürütülür) EF işlemi gerçekte döndürülen sonuç yerine değişen sonucu kullanır.</span><span class="sxs-lookup"><span data-stu-id="bb0e6-229">If an interceptor sets the Result property after the command has executed (in one of the …Executed methods) then EF will use the changed result instead of the result that was actually returned from the operation.</span></span> <span data-ttu-id="bb0e6-230">Komut yürütüldükten sonra özel durum özelliği bir dinleyiciyi ayarlar, işlemi özel durum gibi benzer şekilde, ardından EF kümesi özel durum oluşturur.</span><span class="sxs-lookup"><span data-stu-id="bb0e6-230">Similarly, if an interceptor sets the Exception property after the command has executed, then EF will throw the set exception as if the operation had thrown the exception.</span></span>  

<span data-ttu-id="bb0e6-231">Bir dinleyiciyi, ayrıca özel durum özelliği hiçbir özel durum olduğunu göstermek için null olarak ayarlayabilirsiniz.</span><span class="sxs-lookup"><span data-stu-id="bb0e6-231">An interceptor can also set the Exception property to null to indicate that no exception should be thrown.</span></span> <span data-ttu-id="bb0e6-232">Yürütme işlemi başarısız oldu, ancak EF işlemi başarılı olursa devam etmek için dinleyiciyi istediği, bu yararlı olabilir.</span><span class="sxs-lookup"><span data-stu-id="bb0e6-232">This can be useful if execution of the operation failed but the interceptor wishes EF to continue as if the operation had succeeded.</span></span> <span data-ttu-id="bb0e6-233">Bu genellikle ayrıca EF devam olarak çalışmak için bazı sonuç değeri olan sonuç ayarını içerir.</span><span class="sxs-lookup"><span data-stu-id="bb0e6-233">This usually also involves setting the Result so that EF has some result value to work with as it continues.</span></span>  

#### <a name="originalresult-and-originalexception"></a><span data-ttu-id="bb0e6-234">OriginalResult ve özgün özel durum</span><span class="sxs-lookup"><span data-stu-id="bb0e6-234">OriginalResult and OriginalException</span></span>  

<span data-ttu-id="bb0e6-235">EF bir işlemi yürütüldükten sonra yürütme bir özel durumla başarısız olursa, yürütme başarısız olmadı, sonuç ve OriginalResult özellikleri ya da özel durum ve özgün özel durum özelliklerini ayarlar.</span><span class="sxs-lookup"><span data-stu-id="bb0e6-235">After EF has executed an operation it will set either the Result and OriginalResult properties if execution did not fail or the Exception and OriginalException properties if execution failed with an exception.</span></span>  

<span data-ttu-id="bb0e6-236">OriginalResult ve özgün özel durum özellikleri salt okunurdur ve yalnızca EF tarafından bir işlemi yürütüldükten sonra ayarlanır.</span><span class="sxs-lookup"><span data-stu-id="bb0e6-236">The OriginalResult and OriginalException properties are read-only and are only set by EF after actually executing an operation.</span></span> <span data-ttu-id="bb0e6-237">Bu özellikler dinleyicileri tarafından ayarlanamaz.</span><span class="sxs-lookup"><span data-stu-id="bb0e6-237">These properties cannot be set by interceptors.</span></span> <span data-ttu-id="bb0e6-238">Başka bir deyişle, dinleyiciyi herhangi bir özel durum veya diğer bazı dinleyiciyi gerçek özel durumun aksine tarafından ayarlanan sonuç ya da işlemi çalıştırıldığında oluşan sonuç arasında ayırt edebilir.</span><span class="sxs-lookup"><span data-stu-id="bb0e6-238">This means that any interceptor can distinguish between an exception or result that has been set by some other interceptor as opposed to the real exception or result that occurred when the operation was executed.</span></span>  

### <a name="registering-interceptors"></a><span data-ttu-id="bb0e6-239">Kesiciler kaydediliyor</span><span class="sxs-lookup"><span data-stu-id="bb0e6-239">Registering interceptors</span></span>  

<span data-ttu-id="bb0e6-240">Bir veya daha fazla durdurma arabirimleri uygulayan bir sınıf oluşturulduktan sonra DbInterception sınıfını kullanarak EF ile kaydedilebilir.</span><span class="sxs-lookup"><span data-stu-id="bb0e6-240">Once a class that implements one or more of the interception interfaces has been created it can be registered with EF using the DbInterception class.</span></span> <span data-ttu-id="bb0e6-241">Örneğin:</span><span class="sxs-lookup"><span data-stu-id="bb0e6-241">For example:</span></span>  

``` csharp
DbInterception.Add(new NLogCommandInterceptor());
```  

<span data-ttu-id="bb0e6-242">Kesiciler, DbConfiguration kod tabanlı yapılandırma mekanizmasını kullanma uygulama etki alanı düzeyinde de kaydedilebilir.</span><span class="sxs-lookup"><span data-stu-id="bb0e6-242">Interceptors can also be registered at the app-domain level using the DbConfiguration code-based configuration mechanism.</span></span>  

### <a name="example-logging-to-nlog"></a><span data-ttu-id="bb0e6-243">Örnek: NLog için günlüğe kaydetme</span><span class="sxs-lookup"><span data-stu-id="bb0e6-243">Example: Logging to NLog</span></span>  

<span data-ttu-id="bb0e6-244">Şimdi tüm bunları bir örnek kullanarak, bir araya IDbCommandInterceptor ve [NLog](http://nlog-project.org/) için:</span><span class="sxs-lookup"><span data-stu-id="bb0e6-244">Let’s put all this together into an example that using IDbCommandInterceptor and [NLog](http://nlog-project.org/) to:</span></span>  

- <span data-ttu-id="bb0e6-245">Günlüğe bir uyarı olmayan-zaman uyumsuz olarak yürütülür herhangi bir komutun</span><span class="sxs-lookup"><span data-stu-id="bb0e6-245">Log a warning for any command that is executed non-asynchronously</span></span>  
- <span data-ttu-id="bb0e6-246">Yürütüldüğünde oluşturan herhangi bir komut için hata günlüğü</span><span class="sxs-lookup"><span data-stu-id="bb0e6-246">Log an error for any command that throws when executed</span></span>  

<span data-ttu-id="bb0e6-247">Yukarıda da gösterildiği gibi kaydedilmelidir günlük kaydı yapar sınıfı şöyledir:</span><span class="sxs-lookup"><span data-stu-id="bb0e6-247">Here’s the class that does the logging, which should be registered as shown above:</span></span>  

``` csharp
public class NLogCommandInterceptor : IDbCommandInterceptor
{
    private static readonly Logger Logger = LogManager.GetCurrentClassLogger();

    public void NonQueryExecuting(
        DbCommand command, DbCommandInterceptionContext<int> interceptionContext)
    {
        LogIfNonAsync(command, interceptionContext);
    }

    public void NonQueryExecuted(
        DbCommand command, DbCommandInterceptionContext<int> interceptionContext)
    {
        LogIfError(command, interceptionContext);
    }

    public void ReaderExecuting(
        DbCommand command, DbCommandInterceptionContext<DbDataReader> interceptionContext)
    {
        LogIfNonAsync(command, interceptionContext);
    }

    public void ReaderExecuted(
        DbCommand command, DbCommandInterceptionContext<DbDataReader> interceptionContext)
    {
        LogIfError(command, interceptionContext);
    }

    public void ScalarExecuting(
        DbCommand command, DbCommandInterceptionContext<object> interceptionContext)
    {
        LogIfNonAsync(command, interceptionContext);
    }

    public void ScalarExecuted(
        DbCommand command, DbCommandInterceptionContext<object> interceptionContext)
    {
        LogIfError(command, interceptionContext);
    }

    private void LogIfNonAsync<TResult>(
        DbCommand command, DbCommandInterceptionContext<TResult> interceptionContext)
    {
        if (!interceptionContext.IsAsync)
        {
            Logger.Warn("Non-async command used: {0}", command.CommandText);
        }
    }

    private void LogIfError<TResult>(
        DbCommand command, DbCommandInterceptionContext<TResult> interceptionContext)
    {
        if (interceptionContext.Exception != null)
        {
            Logger.Error("Command {0} failed with exception {1}",
                command.CommandText, interceptionContext.Exception);
        }
    }
}
```  

<span data-ttu-id="bb0e6-248">Bir komut uyumsuz olmayan yürütülürken bulmak ve bir komut yürütülürken bir hata olduğunda bulmak için bu kodu durdurma bağlam nasıl kullandığına dikkat edin.</span><span class="sxs-lookup"><span data-stu-id="bb0e6-248">Notice how this code uses the interception context to discover when a command is being executed non-asynchronously and to discover when there was an error executing a command.</span></span>  
